@page "/home"
@using Microsoft.AspNetCore.Components.Authorization
@inject UserService UserService
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthStateProvider


    <div class="welcome-section">
        <h2>Welcome <span class="firstname">@FirstName</span> !</h2>
        <p>What do you want to do?</p>
    </div>

    <div class="grid-container">
        <div class="grid-item" @onclick="NavigateToHouseRules">
            <div class="icon">📚</div>
            <div class="text">House Rules</div>
        </div>
        <div class="grid-item" @onclick="NavigateToComplaints">
            <div class="icon">⚠️</div>
            <div class="text">Complaints</div>
        </div>
        <div class="grid-item" @onclick="NavigateToEvents">
            <div class="icon">🎉</div>
            <div class="text">Events</div>
        </div>
        <div class="grid-item" @onclick="NavigateToPayments">
            <div class="icon">💸</div>
            <div class="text">Payments</div>
        </div>
        <div class="grid-item" @onclick="NavigateToOpenTasks">
            <div class="icon">✅</div>
            <div class="text">Tasks</div>
        </div>
        <div class="grid-item" @onclick="NavigateToCalendar">
            <div class="icon">📆</div>
            <div class="text">Calendar</div>
        </div>
    </div>

    <footer>
        <h3>Contact us!</h3>
        <div class="footer-icons">
            <a href="https://www.facebook.com" target="_blank" aria-label="Facebook">
                <i class="bi bi-facebook"></i>
            </a>
            <a href="https://www.twitter.com" target="_blank" aria-label="Twitter">
                <i class="bi bi-twitter"></i>
            </a>
            <a href="https://www.instagram.com" target="_blank" aria-label="Instagram">
                <i class="bi bi-instagram"></i>
            </a>
            <a href="https://www.linkedin.com" target="_blank" aria-label="LinkedIn">
                <i class="bi bi-linkedin"></i>
            </a>
        </div>
    </footer>



@code {
    private string FirstName = string.Empty;
    private bool IsAuthenticated = false;
    private bool IsLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var authState = await AuthStateProvider.GetAuthenticationStateAsync();
            var user = authState.User;

            System.Diagnostics.Debug.WriteLine($"IsAuthenticated: {user.Identity.IsAuthenticated}, Username: {user.Identity.Name}");

            if (user.Identity.IsAuthenticated)
            {
                IsAuthenticated = true;
                var username = user.Identity.Name;
                System.Diagnostics.Debug.WriteLine($"Fetching user data for username: {username}");
                var person = await UserService.GetLoggedInUser(username);

                if (person != null)
                {
                    FirstName = person.FirstName;
                    System.Diagnostics.Debug.WriteLine($"Fetched FirstName: {FirstName}");
                }
                else
                {
                    FirstName = "User";
                }
            }
        }
        catch (Exception ex)
        {
            System.Diagnostics.Debug.WriteLine($"Error: {ex.Message}");
        }
        finally
        {
            IsLoading = false;
        }
    }

    private void NavigateToHouseRules() => NavigationManager.NavigateTo("/house-rules");
    private void NavigateToComplaints() => NavigationManager.NavigateTo("/complaints");
    private void NavigateToEvents() => NavigationManager.NavigateTo("/events");
    private void NavigateToPayments() => NavigationManager.NavigateTo("/payments");
    private void NavigateToOpenTasks() => NavigationManager.NavigateTo("/open-tasks");
    private void NavigateToCalendar() => NavigationManager.NavigateTo("/calendar");
}


